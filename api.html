<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Artist Search</title>
  <style>


    body {
        background-color: #000;
        font-family: 'Montserrat', sans-serif;
        margin: 0;
        padding: 0;
    }

    #artist-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      list-style: none;
      padding: 0;
    }

    .artist-item {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    .artist-image {
      max-width: 100%;
      height: auto;
    }

  </style>
</head>
<body>
  <label for="searchInput">Search Artist:</label>
  <input type="text" id="searchInput" placeholder="Enter artist name">
  <button onclick="searchArtists()">Search</button>

  <h1>Artists:</h1>
  <ul id="artist-list"></ul>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const artistList = document.getElementById('artist-list');
      const searchInputField = document.getElementById('searchInput');
      let accessToken = "";

      function getToken() {
        const clientId = '44447c40b5734ee7840b0b7e04f21afa';
        const clientSecret = '4928096133c4412a8c6ad6336344e26f';

        const requestOptions = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}`,
        };

        fetch('https://accounts.spotify.com/api/token', requestOptions)
          .then(response => response.json())
          .then(data => {
            accessToken = data.access_token;
            // Chama a função de pesquisa após obter o token
            searchArtists();
          })
          .catch(error => {
            console.error('Error retrieving token:', error);
          });
      }

      function searchArtists() {
        const searchInput = searchInputField.value;
        const market = 'ES';
        

        const apiUrl = `https://api.spotify.com/v1/search?q=${searchInput}&type=artist&market=${market}`;

        fetch(apiUrl, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
          },
        })
        .then(response => response.json())
        .then(data => {
          // Limpar a lista
          artistList.innerHTML = '';

          // Criar uma entrada na lista para cada artista retornado
          data.artists.items.forEach(artist => {
            const listItem = document.createElement('li');
            listItem.className = 'artist-item';

            const artistImage = document.createElement('img');
            artistImage.className = 'artist-image';
            artistImage.src = artist.images.length > 0 ? artist.images[0].url : 'placeholder.jpg';
            artistImage.alt = artist.name;

            const artistName = document.createElement('p');
            artistName.textContent = artist.name;

            // Adicionar informações adicionais ao dataset, se necessário
            listItem.dataset.artistId = artist.id;

            listItem.appendChild(artistImage);
            listItem.appendChild(artistName);

            artistList.appendChild(listItem);
          });
        })
        .catch(error => {
          console.error('Erro na requisição:', error)
          getToken()
          searchArtists()
        }
        );
      }

      // Adiciona um evento de clique ao botão de pesquisa
      document.querySelector('button').addEventListener('click', searchArtists);
    });
  </script>
</body>
</html>
